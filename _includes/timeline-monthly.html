{% include base_path %}

{% assign limit = include.limit | default: 10 %}
{% assign show_title = include.show_title | default: true %}

{% if show_title %}
<h2 class="timeline-section__title">
  <i class="fa fa-fw fa-clock" aria-hidden="true"></i> 最近动态
</h2>
{% endif %}

<div class="timeline timeline--monthly">
  {% capture written_month %}'None'{% endcapture %}
  {% assign count = 0 %}
  {% for post in site.posts %}
    {% if count >= limit %}
      {% break %}
    {% endif %}
    {% capture month_year %}{{ post.date | date: '%Y年%m月' }}{% endcapture %}
    {% if month_year != written_month %}
      {% unless written_month == "'None'" %}
        </div>
      {% endunless %}
      <div class="timeline__month-group">
        <h3 id="{{ post.date | date: '%Y-%m' | slugify }}" class="timeline__month">{{ month_year }}</h3>
        <div class="timeline__line"></div>
      {% capture written_month %}{{ month_year }}{% endcapture %}
    {% endif %}
    <div class="timeline__item">
      <span class="timeline__node"></span>
      <article class="archive__item">
        <span class="timeline__day">{{ post.date | date: '%d' }}</span>
        <h4 class="archive__item-title">
          <a href="{{ base_path }}{{ post.url }}" rel="permalink">{{ post.title }}</a>
        </h4>
        {% if post.excerpt %}
        <p class="archive__item-excerpt">{{ post.excerpt | markdownify | strip_html | truncate: 80 }}</p>
        {% endif %}
      </article>
    </div>
    {% assign count = count | plus: 1 %}
  {% endfor %}
  {% unless written_month == "'None'" %}
    </div>
  {% endunless %}
</div>

{% if site.posts.size > limit %}
<p class="timeline__more">
  <a href="{{ base_path }}/year-archive/" class="btn btn--primary">查看全部博客 <i class="fa fa-arrow-right" aria-hidden="true"></i></a>
</p>
{% endif %}
