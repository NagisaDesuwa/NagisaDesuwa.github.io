<!-- ç½‘ç«™å…¥å£å¤§é—¨æ•ˆæœ -->
<!-- ç½‘ç«™å…¥å£å¤§é—¨æ•ˆæœ -->
<div id="entrance-gate" class="entrance-gate">
  <div class="gate-content">
    <h1 class="gate-title">æ¬¢è¿æ¥åˆ°Nagisaçš„ä¸–ç•Œ</h1>
    <div class="gate-subtitle">ç‚¹å‡»ä»»æ„ä½ç½®è¿›å…¥</div>
    <div class="gate-click-hint">âœ¨</div>
  </div>
  <div class="gate-overlay"></div>
</div>

<script>
(function() {
  const gate = document.getElementById('entrance-gate');

  // æ£€æŸ¥æ˜¯å¦åœ¨åŒä¸€æµè§ˆå™¨ä¼šè¯ä¸­å·²è®¿é—®è¿‡
  const hasVisited = sessionStorage.getItem('hasVisited');

  if (hasVisited) {
    // å¦‚æœå·²è®¿é—®è¿‡ï¼Œç›´æ¥éšè—å…¥å£é¡µé¢
    gate.style.display = 'none';
    return;
  }

  // æ–°çš„æµè§ˆå™¨ä¼šè¯ï¼Œé‡ç½®éŸ³ä¹æ’­æ”¾çŠ¶æ€
  // æ¸…é™¤æ‰€æœ‰éŸ³ä¹ç›¸å…³çš„ localStorageï¼Œè®©æ’­æ”¾å™¨åŠ è½½é»˜è®¤æ­Œæ›²
  localStorage.removeItem('musicCurrentTrack');
  localStorage.removeItem('musicCurrentTime');
  localStorage.removeItem('musicWasPlaying');
  localStorage.removeItem('musicPlaylistLength');
  console.log('ğŸ”„ æµè§ˆå™¨é‡å¯ï¼ŒéŸ³ä¹çŠ¶æ€å·²é‡ç½®');

  // ç‚¹å‡»åæ¸éšè¿›å…¥ç½‘ç«™å¹¶å¯åŠ¨éŸ³ä¹
  gate.addEventListener('click', function() {
    gate.classList.add('fade-out');

    // å¯åŠ¨éŸ³ä¹æ’­æ”¾ï¼ˆåˆ©ç”¨ç”¨æˆ·äº¤äº’ç»•è¿‡æµè§ˆå™¨çš„è‡ªåŠ¨æ’­æ”¾é™åˆ¶ï¼‰
    const audio = document.getElementById('audio-player');
    const playBtn = document.getElementById('play-btn');

    // å°è¯•å¤šæ¬¡å¯åŠ¨æ’­æ”¾ï¼Œç¡®ä¿æˆåŠŸ
    function tryPlayMusic(attempts) {
      if (attempts <= 0) {
        console.log('éŸ³ä¹æ’­æ”¾å¯åŠ¨å¤±è´¥ï¼Œå·²å°è¯•å¤šæ¬¡');
        return;
      }

      if (audio && playBtn && audio.src) {
        if (audio.paused) {
          audio.play().then(() => {
            playBtn.textContent = 'â¸';
            console.log('éŸ³ä¹å·²å¼€å§‹æ’­æ”¾');
            // ä¿å­˜æ’­æ”¾çŠ¶æ€ï¼Œä¾›é¡µé¢åˆ‡æ¢æ—¶æ¢å¤
            localStorage.setItem('musicWasPlaying', 'true');
          }).catch(error => {
            console.log('æ’­æ”¾å°è¯•å¤±è´¥ï¼Œå‰©ä½™å°è¯•æ¬¡æ•°ï¼š' + (attempts - 1), error);
            // å¦‚æœå¤±è´¥ï¼Œå»¶è¿Ÿåé‡è¯•
            setTimeout(() => tryPlayMusic(attempts - 1), 200);
          });
        } else {
          console.log('éŸ³ä¹å·²åœ¨æ’­æ”¾ä¸­');
        }
      } else {
        // éŸ³é¢‘è¿˜æœªå‡†å¤‡å¥½ï¼Œå»¶è¿Ÿåé‡è¯•
        console.log('éŸ³é¢‘æœªå‡†å¤‡å¥½ï¼Œå»¶è¿Ÿé‡è¯•ï¼Œå‰©ä½™å°è¯•æ¬¡æ•°ï¼š' + (attempts - 1));
        setTimeout(() => tryPlayMusic(attempts - 1), 200);
      }
    }

    // å¼€å§‹å°è¯•æ’­æ”¾ï¼ˆæœ€å¤š5æ¬¡ï¼‰
    setTimeout(() => tryPlayMusic(5), 100);

    // åŠ¨ç”»ç»“æŸåéšè—å…ƒç´ å¹¶æ ‡è®°å·²è®¿é—®
    setTimeout(function() {
      gate.style.display = 'none';
      sessionStorage.setItem('hasVisited', 'true');
    }, 1000); // 1ç§’æ¸éšåŠ¨ç”»
  });

  // æ·»åŠ é¼ æ ‡æ‚¬åœæ•ˆæœ
  gate.addEventListener('mouseenter', function() {
    gate.classList.add('hover');
  });

  gate.addEventListener('mouseleave', function() {
    gate.classList.remove('hover');
  });
})();
</script>
