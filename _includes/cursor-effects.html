{% if site.data.cursor-config.enabled %}
<!-- è‡ªå®šä¹‰é¼ æ ‡æ•ˆæœ - æœåŠ¡å™¨ç«¯é…ç½® -->
<div class="cursor-dot"></div>
<div class="cursor-outline"></div>

<script>
(function() {
  // æœåŠ¡å™¨ç«¯é…ç½®ï¼ˆç”¨æˆ·æ— æ³•ä¿®æ”¹ï¼‰
  const CONFIG = {
    cursorStyle: '{{ site.data.cursor-config.cursor_style }}',
    trail: {
      enabled: {{ site.data.cursor-config.trail.enabled }},
      interval: {{ site.data.cursor-config.trail.interval }},
      lifetime: {{ site.data.cursor-config.trail.lifetime }},
      size: {{ site.data.cursor-config.trail.size }},
      color: '{{ site.data.cursor-config.trail.color }}',
      blur: {{ site.data.cursor-config.trail.blur }}
    },
    ripple: {
      enabled: {{ site.data.cursor-config.ripple.enabled }},
      size: {{ site.data.cursor-config.ripple.size }},
      duration: {{ site.data.cursor-config.ripple.duration }},
      color: '{{ site.data.cursor-config.ripple.color }}'
    },
    speed: {
      dot: {{ site.data.cursor-config.cursor_speed.dot }},
      outline: {{ site.data.cursor-config.cursor_speed.outline }}
    },
    cursor_size: {
      dot: {{ site.data.cursor-config.cursor_size.dot }},
      outline: {{ site.data.cursor-config.cursor_size.outline }},
      dot_color: '{{ site.data.cursor-config.cursor_size.dot_color }}',
      outline_color: '{{ site.data.cursor-config.cursor_size.outline_color }}'
    },
    advanced: {
      hover_scale: {{ site.data.cursor-config.advanced.hover_scale }},
      click_scale: {{ site.data.cursor-config.advanced.click_scale }}
    }
  };

  console.log('ğŸ¯ é¼ æ ‡ç‰¹æ•ˆé…ç½®:', CONFIG);

  // æ£€æŸ¥æ˜¯å¦ä¸ºç§»åŠ¨è®¾å¤‡
  const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

  if (isMobile) {
    console.log('ğŸ“± ç§»åŠ¨è®¾å¤‡æ£€æµ‹ï¼Œè·³è¿‡é¼ æ ‡ç‰¹æ•ˆ');
    return;
  }

  // è·å–å…‰æ ‡å…ƒç´ 
  const cursorDot = document.querySelector('.cursor-dot');
  const cursorOutline = document.querySelector('.cursor-outline');

  if (!cursorDot || !cursorOutline) {
    console.error('âŒ æ‰¾ä¸åˆ°å…‰æ ‡å…ƒç´ ');
    return;
  }

  console.log('âœ… å…‰æ ‡å…ƒç´ å·²æ‰¾åˆ°');

  // åº”ç”¨åŠ¨æ€æ ·å¼
  function applyDynamicStyles() {
    // è®¾ç½®å…‰æ ‡ç‚¹æ ·å¼
    cursorDot.style.width = CONFIG.cursor_size.dot + 'px';
    cursorDot.style.height = CONFIG.cursor_size.dot + 'px';
    cursorDot.style.background = CONFIG.cursor_size.dot_color;

    // è®¾ç½®å…‰æ ‡å¤–åœˆæ ·å¼
    cursorOutline.style.width = CONFIG.cursor_size.outline + 'px';
    cursorOutline.style.height = CONFIG.cursor_size.outline + 'px';
    cursorOutline.style.border = '2px solid ' + CONFIG.cursor_size.outline_color;
  }

  let mouseX = 0, mouseY = 0;
  let dotX = 0, dotY = 0;
  let outlineX = 0, outlineY = 0;
  let lastTrailTime = 0;

  // åº”ç”¨é…ç½®çš„å…‰æ ‡æ ·å¼
  function applyCursorStyle() {
    document.body.classList.remove('cursor-default', 'cursor-dot-style', 'cursor-arrow-enhanced');

    switch(CONFIG.cursorStyle) {
      case 'dot':
        document.body.classList.add('cursor-dot-style');
        cursorDot.classList.add('active');
        cursorOutline.classList.add('active');
        console.log('âœ¨ åº”ç”¨åœ†ç‚¹å…‰æ ‡æ ·å¼');
        break;
      case 'arrow-enhanced':
        document.body.classList.add('cursor-arrow-enhanced');
        cursorDot.classList.remove('active');
        cursorOutline.classList.remove('active');
        console.log('âœ¨ åº”ç”¨å¢å¼ºç®­å¤´æ ·å¼');
        break;
      default:
        document.body.classList.add('cursor-default');
        cursorDot.classList.remove('active');
        cursorOutline.classList.remove('active');
        console.log('âœ¨ åº”ç”¨é»˜è®¤å…‰æ ‡æ ·å¼');
    }
  }

  // é¼ æ ‡ç§»åŠ¨äº‹ä»¶
  document.addEventListener('mousemove', function(e) {
    mouseX = e.clientX;
    mouseY = e.clientY;

    // æ·»åŠ æ‹–å°¾æ•ˆæœï¼ˆæ ¹æ®é…ç½®ï¼‰
    if (CONFIG.trail.enabled) {
      const now = Date.now();
      if (now - lastTrailTime > CONFIG.trail.interval) {
        createTrail(mouseX, mouseY);
        lastTrailTime = now;
      }
    }
  });

  // å¹³æ»‘è·ŸéšåŠ¨ç”»
  function animateCursor() {
    // å…‰æ ‡ç‚¹è·Ÿéšï¼ˆä½¿ç”¨é…ç½®çš„é€Ÿåº¦ï¼‰
    dotX += (mouseX - dotX) * CONFIG.speed.dot;
    dotY += (mouseY - dotY) * CONFIG.speed.dot;

    // å¤–åœˆè·Ÿéšï¼ˆä½¿ç”¨é…ç½®çš„é€Ÿåº¦ï¼‰
    outlineX += (mouseX - outlineX) * CONFIG.speed.outline;
    outlineY += (mouseY - outlineY) * CONFIG.speed.outline;

    cursorDot.style.left = dotX + 'px';
    cursorDot.style.top = dotY + 'px';
    cursorOutline.style.left = outlineX + 'px';
    cursorOutline.style.top = outlineY + 'px';

    requestAnimationFrame(animateCursor);
  }

  // é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶
  document.addEventListener('mousedown', function(e) {
    document.body.classList.add('dragging');
    cursorDot.classList.add('clicking');
    cursorOutline.classList.add('clicking');

    // åº”ç”¨ç‚¹å‡»ç¼©æ”¾
    cursorDot.style.transform = 'translate(-50%, -50%) scale(' + CONFIG.advanced.click_scale + ')';
    cursorOutline.style.transform = 'translate(-50%, -50%) scale(' + CONFIG.advanced.click_scale + ')';

    // åˆ›å»ºç‚¹å‡»æ³¢çº¹ï¼ˆæ ¹æ®é…ç½®ï¼‰
    if (CONFIG.ripple.enabled) {
      createRipple(e.clientX, e.clientY);
    }
  });

  // é¼ æ ‡æŠ¬èµ·äº‹ä»¶
  document.addEventListener('mouseup', function() {
    document.body.classList.remove('dragging');
    cursorDot.classList.remove('clicking');
    cursorOutline.classList.remove('clicking');

    // æ¢å¤åŸå§‹å¤§å°
    cursorDot.style.transform = 'translate(-50%, -50%) scale(1)';
    cursorOutline.style.transform = 'translate(-50%, -50%) scale(1)';
  });

  // æ‚¬åœåœ¨å¯ç‚¹å‡»å…ƒç´ ä¸Š
  const hoverTargets = 'a, button, .clickable, input, textarea, select';

  document.addEventListener('mouseover', function(e) {
    if (e.target.matches(hoverTargets)) {
      cursorDot.classList.add('hovering');
      cursorOutline.classList.add('hovering');

      // åº”ç”¨æ‚¬åœç¼©æ”¾
      cursorDot.style.transform = 'translate(-50%, -50%) scale(' + CONFIG.advanced.hover_scale + ')';
      cursorOutline.style.transform = 'translate(-50%, -50%) scale(' + CONFIG.advanced.hover_scale + ')';
    }
  });

  document.addEventListener('mouseout', function(e) {
    if (e.target.matches(hoverTargets)) {
      cursorDot.classList.remove('hovering');
      cursorOutline.classList.remove('hovering');

      // æ¢å¤åŸå§‹å¤§å°
      cursorDot.style.transform = 'translate(-50%, -50%) scale(1)';
      cursorOutline.style.transform = 'translate(-50%, -50%) scale(1)';
    }
  });

  // åˆ›å»ºç‚¹å‡»æ³¢çº¹æ•ˆæœ
  function createRipple(x, y) {
    const ripple = document.createElement('div');
    ripple.className = 'click-ripple';
    ripple.style.width = CONFIG.ripple.size + 'px';
    ripple.style.height = CONFIG.ripple.size + 'px';
    ripple.style.border = '2px solid ' + CONFIG.ripple.color;
    ripple.style.left = (x - CONFIG.ripple.size / 2) + 'px';
    ripple.style.top = (y - CONFIG.ripple.size / 2) + 'px';
    document.body.appendChild(ripple);

    setTimeout(() => {
      ripple.remove();
    }, CONFIG.ripple.duration);
  }

  // åˆ›å»ºé¼ æ ‡æ‹–å°¾æ•ˆæœ
  function createTrail(x, y) {
    const trail = document.createElement('div');
    trail.className = 'cursor-trail';
    trail.style.width = CONFIG.trail.size + 'px';
    trail.style.height = CONFIG.trail.size + 'px';
    trail.style.background = CONFIG.trail.color;
    trail.style.filter = 'blur(' + CONFIG.trail.blur + 'px)';
    trail.style.left = x + 'px';
    trail.style.top = y + 'px';
    document.body.appendChild(trail);

    setTimeout(() => {
      trail.remove();
    }, CONFIG.trail.lifetime);
  }

  // åº”ç”¨æ‰€æœ‰æ ·å¼å’Œé…ç½®
  applyDynamicStyles();
  applyCursorStyle();
  animateCursor();

  console.log('âœ… é¼ æ ‡ç‰¹æ•ˆå·²å¯åŠ¨');
})();
</script>
{% endif %}
