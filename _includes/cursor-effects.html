{% if site.data.cursor-config.enabled %}
<!-- 自定义鼠标效果 - 服务器端配置 -->
<div class="cursor-dot"></div>
<div class="cursor-outline"></div>

<style>
/* 动态注入配置样式 */
.cursor-dot {
  width: {{ site.data.cursor-config.cursor_size.dot }}px;
  height: {{ site.data.cursor-config.cursor_size.dot }}px;
  background-color: {{ site.data.cursor-config.cursor_size.dot_color }};
  transition: transform {{ site.data.cursor-config.advanced.transition_speed }}ms ease;
}

.cursor-outline {
  width: {{ site.data.cursor-config.cursor_size.outline }}px;
  height: {{ site.data.cursor-config.cursor_size.outline }}px;
  border: 2px solid {{ site.data.cursor-config.cursor_size.outline_color }};
  transition: transform {{ site.data.cursor-config.advanced.transition_speed }}ms ease;
}

.cursor-dot.hovering {
  transform: scale({{ site.data.cursor-config.advanced.hover_scale }});
}

.cursor-outline.hovering {
  transform: scale({{ site.data.cursor-config.advanced.hover_scale }});
}

.cursor-dot.clicking {
  transform: scale({{ site.data.cursor-config.advanced.click_scale }});
}

.cursor-outline.clicking {
  transform: scale({{ site.data.cursor-config.advanced.click_scale }});
}

.cursor-trail {
  width: {{ site.data.cursor-config.trail.size }}px;
  height: {{ site.data.cursor-config.trail.size }}px;
  background-color: {{ site.data.cursor-config.trail.color }};
  filter: blur({{ site.data.cursor-config.trail.blur }}px);
}

.click-ripple {
  width: {{ site.data.cursor-config.ripple.size }}px;
  height: {{ site.data.cursor-config.ripple.size }}px;
  border: 2px solid {{ site.data.cursor-config.ripple.color }};
  animation: ripple-animation {{ site.data.cursor-config.ripple.duration }}ms ease-out;
}
</style>

<script>
(function() {
  // 服务器端配置（用户无法修改）
  const CONFIG = {
    cursorStyle: '{{ site.data.cursor-config.cursor_style }}',
    trail: {
      enabled: {{ site.data.cursor-config.trail.enabled }},
      interval: {{ site.data.cursor-config.trail.interval }},
      lifetime: {{ site.data.cursor-config.trail.lifetime }}
    },
    ripple: {
      enabled: {{ site.data.cursor-config.ripple.enabled }},
      duration: {{ site.data.cursor-config.ripple.duration }}
    },
    speed: {
      dot: {{ site.data.cursor-config.cursor_speed.dot }},
      outline: {{ site.data.cursor-config.cursor_speed.outline }}
    }
  };

  // 检查是否为移动设备
  const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

  if (isMobile) {
    return;
  }

  // 获取光标元素
  const cursorDot = document.querySelector('.cursor-dot');
  const cursorOutline = document.querySelector('.cursor-outline');

  if (!cursorDot || !cursorOutline) return;

  let mouseX = 0, mouseY = 0;
  let dotX = 0, dotY = 0;
  let outlineX = 0, outlineY = 0;
  let lastTrailTime = 0;

  // 应用配置的光标样式
  function applyCursorStyle() {
    document.body.classList.remove('cursor-default', 'cursor-dot-style', 'cursor-arrow-enhanced');

    switch(CONFIG.cursorStyle) {
      case 'dot':
        document.body.classList.add('cursor-dot-style');
        cursorDot.classList.add('active');
        cursorOutline.classList.add('active');
        break;
      case 'arrow-enhanced':
        document.body.classList.add('cursor-arrow-enhanced');
        cursorDot.classList.remove('active');
        cursorOutline.classList.remove('active');
        break;
      default:
        document.body.classList.add('cursor-default');
        cursorDot.classList.remove('active');
        cursorOutline.classList.remove('active');
    }
  }

  // 鼠标移动事件
  document.addEventListener('mousemove', function(e) {
    mouseX = e.clientX;
    mouseY = e.clientY;

    // 添加拖尾效果（根据配置）
    if (CONFIG.trail.enabled) {
      const now = Date.now();
      if (now - lastTrailTime > CONFIG.trail.interval) {
        createTrail(mouseX, mouseY);
        lastTrailTime = now;
      }
    }
  });

  // 平滑跟随动画
  function animateCursor() {
    // 光标点跟随（使用配置的速度）
    dotX += (mouseX - dotX) * CONFIG.speed.dot;
    dotY += (mouseY - dotY) * CONFIG.speed.dot;

    // 外圈跟随（使用配置的速度）
    outlineX += (mouseX - outlineX) * CONFIG.speed.outline;
    outlineY += (mouseY - outlineY) * CONFIG.speed.outline;

    cursorDot.style.left = dotX + 'px';
    cursorDot.style.top = dotY + 'px';
    cursorOutline.style.left = outlineX + 'px';
    cursorOutline.style.top = outlineY + 'px';

    requestAnimationFrame(animateCursor);
  }

  animateCursor();

  // 鼠标按下事件
  document.addEventListener('mousedown', function(e) {
    document.body.classList.add('dragging');
    cursorDot.classList.add('clicking');
    cursorOutline.classList.add('clicking');

    // 创建点击波纹（根据配置）
    if (CONFIG.ripple.enabled) {
      createRipple(e.clientX, e.clientY);
    }
  });

  // 鼠标抬起事件
  document.addEventListener('mouseup', function() {
    document.body.classList.remove('dragging');
    cursorDot.classList.remove('clicking');
    cursorOutline.classList.remove('clicking');
  });

  // 悬停在可点击元素上
  const hoverTargets = 'a, button, .clickable, input, textarea, select';

  document.addEventListener('mouseover', function(e) {
    if (e.target.matches(hoverTargets)) {
      cursorDot.classList.add('hovering');
      cursorOutline.classList.add('hovering');
    }
  });

  document.addEventListener('mouseout', function(e) {
    if (e.target.matches(hoverTargets)) {
      cursorDot.classList.remove('hovering');
      cursorOutline.classList.remove('hovering');
    }
  });

  // 创建点击波纹效果
  function createRipple(x, y) {
    const ripple = document.createElement('div');
    ripple.className = 'click-ripple';
    const halfSize = {{ site.data.cursor-config.ripple.size }} / 2;
    ripple.style.left = (x - halfSize) + 'px';
    ripple.style.top = (y - halfSize) + 'px';
    document.body.appendChild(ripple);

    setTimeout(() => {
      ripple.remove();
    }, CONFIG.ripple.duration);
  }

  // 创建鼠标拖尾效果
  function createTrail(x, y) {
    const trail = document.createElement('div');
    trail.className = 'cursor-trail';
    trail.style.left = x + 'px';
    trail.style.top = y + 'px';
    document.body.appendChild(trail);

    setTimeout(() => {
      trail.remove();
    }, CONFIG.trail.lifetime);
  }

  // 应用配置的样式
  applyCursorStyle();
})();
</script>
{% endif %}
